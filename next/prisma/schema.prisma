generator client {
  provider        = "prisma-client"
  output          = "./generated"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "postgresql"
}

// prisma doesn't allow enum values to start with a number
// this enum must be in ascending lexicographical order, as well as ascending logical order
enum ModelYear {
  MY_2017
  MY_2018
  MY_2019
  MY_2020
  MY_2021
  MY_2022
  MY_2023
  MY_2024
  MY_2025
  MY_2026
  MY_2027
  MY_2028
  MY_2029
  MY_2030
  MY_2031
  MY_2032
  MY_2033
  MY_2034
  MY_2035
  MY_2036
}

enum SupplierClass {
  LARGE_VOLUME_SUPPLIER
  MEDIUM_VOLUME_SUPPLIER
  SMALL_VOLUME_SUPPLIER
}

model Organization {
  id                            Int                             @id @default(autoincrement())
  name                          String
  isGovernment                  Boolean                         @default(false) @map("is_government")
  isActive                      Boolean                         @default(true) @map("is_active")
  shortName                     String                          @map("short_name")
  supplierClass                 SupplierClass?                  @map("supplier_class")
  users                         User[]
  zevUnitTransactions           ZevUnitTransaction[]
  zevUnitEndingBalances         ZevUnitEndingBalance[]
  creditTransferTo              CreditTransfer[]                @relation("creditTransferTo")
  creditTransferFrom            CreditTransfer[]                @relation("creditTransferFrom")
  Vehicle                       Vehicle[]
  organizationAddress           OrganizationAddress[]
  CreditApplication             CreditApplication[]
  PenaltyCredit                 PenaltyCredit[]
  agreements                    Agreement[]
  LegacySalesVolume             LegacySalesVolume[]
  SupplyVolume                  SupplyVolume[]
  ModelYearReport               ModelYearReport[]
  Reassessment                  Reassessment[]
  SupplementaryReport           SupplementaryReport[]
  LegacyAssessedModelYearReport LegacyAssessedModelYearReport[]
  vehicleAttachments            VehicleAttachment[]
  creditApplicationAttachments  CreditApplicationAttachment[]
  agreementAttachments          AgreementAttachment[]

  @@map("organization")
}

model OrganizationAddress {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  addressType    AddressType  @map("address_type")
  expirationDate DateTime?    @map("expiration_date") @db.Date
  addressLines   String?      @map("address_lines")
  city           String?
  postalCode     String?      @map("postal_code")
  state          String?
  county         String?
  country        String?
  representative String?

  @@unique([organizationId, addressType])
  @@map("organization_address")
}

enum AddressType {
  RECORDS
  SERVICE
}

enum Role {
  ADMINISTRATOR
  DIRECTOR
  ORGANIZATION_ADMINISTRATOR
  SIGNING_AUTHORITY
  ZEVA_BCEID_USER
  ZEVA_IDIR_USER
  ZEVA_IDIR_USER_READ_ONLY
}

enum Idp {
  AZURE_IDIR
  BCEID_BUSINESS
}

enum Notification {
  CREDIT_APPLICATION
  CREDIT_TRANSFER
  MODEL_YEAR_REPORT
  ZEV_MODEL
}

model User {
  id                         Int                          @id @default(autoincrement())
  contactEmail               String?                      @map("contact_email")
  idpSub                     String?                      @map("idp_sub")
  idp                        Idp                          @map("idp")
  idpUsername                String                       @map("idp_username")
  isActive                   Boolean                      @default(true) @map("is_active")
  organization               Organization                 @relation(fields: [organizationId], references: [id])
  organizationId             Int                          @map("organization_id")
  roles                      Role[]
  notifications              Notification[]
  firstName                  String                       @map("first_name")
  lastName                   String                       @map("last_name")
  VehicleHistory             VehicleHistory[]
  CreditApplicationHistory   CreditApplicationHistory[]
  PenaltyCreditHistory       PenaltyCreditHistory[]
  AgreementHistory           AgreementHistory[]
  ModelYearReportHistory     ModelYearReportHistory[]
  ReassessmentHistory        ReassessmentHistory[]
  CreditTransferHistory      CreditTransferHistory[]
  SupplementaryReportHistory SupplementaryReportHistory[]

  @@unique([idp, idpUsername])
  @@map("user")
}

enum TransactionType {
  CREDIT
  DEBIT
  TRANSFER_AWAY
}

enum ReferenceType {
  AGREEMENT
  ASSESSMENT_ADJUSTMENT
  COMPLIANCE_RATIO_REDUCTION
  PENALTY_CREDITS
  SUPPLY_CREDITS
  TRANSFER
}

enum ZevClass {
  A
  B
  C
  UNSPECIFIED
}

enum VehicleClass {
  REPORTABLE
}

model ZevUnitTransaction {
  id                Int             @id @default(autoincrement())
  organization      Organization    @relation(fields: [organizationId], references: [id])
  organizationId    Int             @map("organization_id")
  type              TransactionType
  referenceType     ReferenceType   @map("reference_type")
  referenceId       Int?            @map("reference_id")
  legacyReferenceId Int?            @map("legacy_reference_id")
  numberOfUnits     Decimal         @map("number_of_units") @db.Decimal(65, 2)
  zevClass          ZevClass        @map("zev_class")
  vehicleClass      VehicleClass    @map("vehicle_class")
  modelYear         ModelYear       @map("model_year")
  timestamp         DateTime        @default(now()) @db.Timestamptz(6)

  @@map("zev_unit_transaction")
}

enum BalanceType {
  CREDIT
  DEBIT
}

model ZevUnitEndingBalance {
  id                   Int          @id @default(autoincrement())
  organization         Organization @relation(fields: [organizationId], references: [id])
  organizationId       Int          @map("organization_id")
  complianceYear       ModelYear    @map("compliance_year")
  type                 BalanceType
  initialNumberOfUnits Decimal      @map("initial_number_of_units") @db.Decimal(65, 2)
  finalNumberOfUnits   Decimal      @map("final_number_of_units") @db.Decimal(65, 2)
  zevClass             ZevClass     @map("zev_class")
  vehicleClass         VehicleClass @map("vehicle_class")
  modelYear            ModelYear    @map("model_year")

  @@unique([organizationId, complianceYear, zevClass, vehicleClass, modelYear])
  @@map("zev_unit_ending_balance")
}

enum CreditTransferStatus {
  APPROVED_BY_GOV
  APPROVED_BY_TRANSFER_TO
  RECOMMEND_APPROVAL_GOV
  RECOMMEND_REJECTION_GOV
  REJECTED_BY_GOV
  REJECTED_BY_TRANSFER_TO
  RESCINDED_BY_TRANSFER_FROM
  RETURNED_TO_ANALYST
  SUBMITTED_TO_TRANSFER_TO
}

enum CreditTransferSupplierStatus {
  APPROVED_BY_GOV
  APPROVED_BY_TRANSFER_TO
  REJECTED_BY_GOV
  REJECTED_BY_TRANSFER_TO
  RESCINDED_BY_TRANSFER_FROM
  SUBMITTED_TO_TRANSFER_TO
}

model CreditTransfer {
  id                    Int                          @id @default(autoincrement())
  transferToId          Int                          @map("transfer_to_id")
  transferTo            Organization                 @relation("creditTransferTo", fields: [transferToId], references: [id])
  transferFromId        Int                          @map("transfer_from_id")
  transferFrom          Organization                 @relation("creditTransferFrom", fields: [transferFromId], references: [id])
  status                CreditTransferStatus
  supplierStatus        CreditTransferSupplierStatus
  creditTransferContent CreditTransferContent[]
  creditTransferHistory CreditTransferHistory[]

  @@map("credit_transfer")
}

model CreditTransferContent {
  id                 Int            @id @default(autoincrement())
  creditTransferId   Int            @map("credit_transfer_id")
  creditTransfer     CreditTransfer @relation(fields: [creditTransferId], references: [id])
  numberOfUnits      Decimal        @map("number_of_units") @db.Decimal(65, 2)
  zevClass           ZevClass       @map("zev_class")
  vehicleClass       VehicleClass   @map("vehicle_class")
  modelYear          ModelYear      @map("model_year")
  dollarValuePerUnit Decimal        @map("dollar_value_per_unit") @db.Decimal(65, 2)

  @@map("credit_transfer_content")
}

model CreditTransferHistory {
  id               Int                  @id @default(autoincrement())
  creditTransferId Int                  @map("credit_transfer_id")
  creditTransfer   CreditTransfer       @relation(fields: [creditTransferId], references: [id])
  userId           Int                  @map("user_id")
  user             User                 @relation(fields: [userId], references: [id])
  timestamp        DateTime             @default(now()) @db.Timestamptz(6)
  userAction       CreditTransferStatus @map("user_action")
  comment          String?

  @@map("credit_transfer_history")
}

enum ZevType {
  BEV
  EREV
  FCEV
  PHEV
}

enum VehicleClassCode {
  COMPACT
  FULL_SIZE
  MID_SIZE
  MINICOMPACT
  MINIVAN
  PICKUP_TRUCK_SMALL
  PICKUP_TRUCK_STANDARD
  SPECIAL_PURPOSE_VEHICLE
  SPORT_UTILITY_VEHICLE_SMALL
  SPORT_UTILITY_VEHICLE_STANDARD
  STATION_WAGON_MIDSIZE
  STATION_WAGON_SMALL
  SUBCOMPACT
  TWO_SEATER
  VAN_CARGO
  VAN_PASSENGER
}

enum VehicleStatus {
  DRAFT
  RETURNED_TO_SUPPLIER
  SUBMITTED
  VALIDATED
}

model Vehicle {
  id                Int                 @id @default(autoincrement())
  legacyId          Int?
  organization      Organization        @relation(fields: [organizationId], references: [id])
  organizationId    Int                 @map("organization_id")
  status            VehicleStatus
  make              String
  modelName         String              @map("model_name")
  modelYear         ModelYear           @map("model_year")
  zevType           ZevType             @map("zev_type")
  range             Int
  vehicleClass      VehicleClass        @map("vehicle_class")
  zevClass          ZevClass            @map("zev_class")
  numberOfUnits     Decimal             @map("numberOfUnits") @db.Decimal(65, 2)
  vehicleClassCode  VehicleClassCode    @map("vehicle_class_code")
  weight            Int
  us06RangeGte16    Boolean             @map("us06_range_gte_16")
  isActive          Boolean             @map("is_active")
  issuedCount       Int                 @default(0) @map("issued_count")
  submittedCount    Int                 @default(0) @map("submitted_count")
  VehicleHistory    VehicleHistory[]
  VehicleAttachment VehicleAttachment[]

  @@map("vehicle")
}

enum VehicleHistoryStatus {
  RETURNED_TO_SUPPLIER
  SUBMITTED
  VALIDATED
}

model VehicleHistory {
  id         Int                  @id @default(autoincrement())
  vehicleId  Int                  @map("vehicle_id")
  vehicle    Vehicle              @relation(fields: [vehicleId], references: [id])
  userId     Int                  @map("user_id")
  user       User                 @relation(fields: [userId], references: [id])
  timestamp  DateTime             @default(now()) @db.Timestamptz(6)
  userAction VehicleHistoryStatus @map("user_action")
  comment    String?

  @@map("vehicle_history")
}

model VehicleAttachment {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  vehicleId      Int?         @map("vehicle_id")
  vehicle        Vehicle?     @relation(fields: [vehicleId], references: [id])
  fileName       String?      @map("file_name")
  objectName     String       @unique @map("object_name")

  @@map("vehicle_attachment")
}

enum IcbcFileStatus {
  FAILURE
  PROCESSING
  SUCCESS
}

model IcbcFile {
  id                            Int            @id @default(autoincrement())
  isLegacy                      Boolean        @default(false) @map("is_legacy")
  name                          String         @unique
  status                        IcbcFileStatus
  timestamp                     DateTime       @db.Timestamptz(6)
  numberOfRecordsPreProcessing  Int?           @map("number_of_records_pre_processing")
  numberOfRecordsPostProcessing Int?           @map("number_of_records_post_processing")
  icbcRecords                   IcbcRecord[]

  @@map("icbc_file")
}

model IcbcRecord {
  id         Int       @id @default(autoincrement())
  icbcFileId Int       @map("icbc_file_id")
  icbcFile   IcbcFile  @relation(fields: [icbcFileId], references: [id])
  vin        String    @unique @db.VarChar(17)
  make       String
  model      String
  year       ModelYear

  @@map("icbc_record")
}

enum CreditApplicationStatus {
  APPROVED
  DRAFT
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
  RETURNED_TO_SUPPLIER
  SUBMITTED
}

enum CreditApplicationSupplierStatus {
  APPROVED
  DRAFT
  RETURNED_TO_SUPPLIER
  SUBMITTED
}

model CreditApplication {
  id                          Int                             @id @default(autoincrement())
  organization                Organization                    @relation(fields: [organizationId], references: [id])
  organizationId              Int                             @map("organization_id")
  submissionTimestamp         DateTime?                       @map("submission_timestamp") @db.Timestamptz(6)
  transactionTimestamps       DateTime[]                      @map("transaction_timestamps") @db.Timestamptz(6)
  status                      CreditApplicationStatus         @map("status")
  supplierStatus              CreditApplicationSupplierStatus @map("supplier_status")
  modelYears                  ModelYear[]                     @map("model_years")
  supplierName                String                          @map("supplier_name")
  makes                       String[]
  serviceAddress              String                          @map("service_address")
  recordsAddress              String                          @map("records_address")
  eligibleVinsCount           Int?                            @map("eligible_vins_count")
  ineligibleVinsCount         Int?                            @map("ineligible_vins_count")
  aCredits                    Decimal?                        @map("a_credits") @db.Decimal(65, 2)
  bCredits                    Decimal?                        @map("b_credits") @db.Decimal(65, 2)
  icbcTimestamp               DateTime?                       @map("icbc_timestamp") @db.Timestamptz(6)
  CreditApplicationHistory    CreditApplicationHistory[]
  CreditApplicationRecord     CreditApplicationRecord[]
  CreditApplicationAttachment CreditApplicationAttachment[]

  @@map("credit_application")
}

enum CreditApplicationHistoryStatus {
  APPROVED
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
  RETURNED_TO_SUPPLIER
  SUBMITTED
}

model CreditApplicationHistory {
  id                  Int                            @id @default(autoincrement())
  creditApplicationId Int                            @map("credit_application_id")
  creditApplication   CreditApplication              @relation(fields: [creditApplicationId], references: [id])
  userId              Int                            @map("user_id")
  user                User                           @relation(fields: [userId], references: [id])
  timestamp           DateTime                       @default(now()) @db.Timestamptz(6)
  userAction          CreditApplicationHistoryStatus @map("user_action")
  comment             String?

  @@map("credit_application_history")
}

model CreditApplicationRecord {
  id                  Int               @id @default(autoincrement())
  creditApplicationId Int               @map("credit_application_id")
  creditApplication   CreditApplication @relation(fields: [creditApplicationId], references: [id])
  vin                 String            @db.VarChar(17)
  timestamp           DateTime          @db.Timestamptz(6)
  vehicleClass        VehicleClass      @map("vehicle_class")
  zevClass            ZevClass          @map("zev_class")
  modelYear           ModelYear         @map("model_year")
  numberOfUnits       Decimal           @map("number_of_units") @db.Decimal(65, 2)
  make                String
  modelName           String            @map("model_name")
  zevType             ZevType           @map("zev_type")
  range               Int
  icbcMake            String?           @map("icbc_make")
  icbcModelName       String?           @map("icbc_model_name")
  icbcModelYear       ModelYear?        @map("icbc_model_year")
  validated           Boolean
  reason              String?
  warnings            String[]

  @@map("credit_application_record")
}

model CreditApplicationAttachment {
  id                  Int                @id @default(autoincrement())
  organization        Organization       @relation(fields: [organizationId], references: [id])
  organizationId      Int                @map("organization_id")
  creditApplicationId Int?               @map("credit_application_id")
  creditApplication   CreditApplication? @relation(fields: [creditApplicationId], references: [id])
  fileName            String?            @map("file_name")
  objectName          String             @unique @map("object_name")
  isApplication       Boolean            @default(false) @map("is_application")

  @@map("credit_application_attachment")
}

model ReservedVin {
  id  Int    @id @default(autoincrement())
  vin String @unique @db.VarChar(17)

  @@map("reserved_vin")
}

enum PenaltyCreditStatus {
  APPROVED
  REJECTED
  SUBMITTED_TO_DIRECTOR
}

model PenaltyCredit {
  id                   Int                    @id @default(autoincrement())
  organization         Organization           @relation(fields: [organizationId], references: [id])
  organizationId       Int                    @map("organization_id")
  complianceYear       ModelYear              @map("compliance_year")
  status               PenaltyCreditStatus
  vehicleClass         VehicleClass           @map("vehicle_class")
  zevClass             ZevClass               @map("zev_class")
  modelYear            ModelYear              @map("model_year")
  numberOfUnits        Decimal                @map("number_of_units") @db.Decimal(65, 2)
  PenaltyCreditHistory PenaltyCreditHistory[]

  @@map("penalty_credit")
}

model PenaltyCreditHistory {
  id              Int                 @id @default(autoincrement())
  penaltyCredit   PenaltyCredit       @relation(fields: [penaltyCreditId], references: [id])
  penaltyCreditId Int                 @map("penalty_credit_id")
  userId          Int                 @map("user_id")
  user            User                @relation(fields: [userId], references: [id])
  timestamp       DateTime            @default(now()) @db.Timestamptz(6)
  userAction      PenaltyCreditStatus @map("user_action")
  comment         String?

  @@map("penalty_credit_history")
}

enum AgreementType {
  INITIATIVE
  PURCHASE
}

enum AgreementStatus {
  DRAFT
  ISSUED
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
}

model Agreement {
  id                  Int                   @id @default(autoincrement())
  organization        Organization          @relation(fields: [organizationId], references: [id])
  organizationId      Int                   @map("organization_id")
  agreementType       AgreementType         @map("agreement_type")
  status              AgreementStatus
  date                String
  aCredits            Decimal               @map("a_credits") @db.Decimal(65, 2)
  bCredits            Decimal               @map("b_credits") @db.Decimal(65, 2)
  agreementContent    AgreementContent[]
  agreementHistory    AgreementHistory[]
  agreementAttachment AgreementAttachment[]

  @@map("agreement")
}

model AgreementContent {
  id            Int          @id @default(autoincrement())
  agreement     Agreement    @relation(fields: [agreementId], references: [id])
  agreementId   Int          @map("agreement_id")
  vehicleClass  VehicleClass @map("vehicle_class")
  zevClass      ZevClass     @map("zev_class")
  modelYear     ModelYear    @map("model_year")
  numberOfUnits Decimal      @map("number_of_units") @db.Decimal(65, 2)

  @@map("agreement_content")
}

enum AgreementHistoryStatus {
  ISSUED
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
}

model AgreementHistory {
  id          Int                    @id @default(autoincrement())
  agreementId Int                    @map("agreement_id")
  agreement   Agreement              @relation(fields: [agreementId], references: [id])
  userId      Int                    @map("user_id")
  user        User                   @relation(fields: [userId], references: [id])
  timestamp   DateTime               @default(now()) @db.Timestamptz(6)
  userAction  AgreementHistoryStatus @map("user_action")
  comment     String?

  @@map("agreement_history")
}

model AgreementAttachment {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  agreementId    Int?         @map("agreement_id")
  agreement      Agreement?   @relation(fields: [agreementId], references: [id])
  fileName       String?      @map("file_name")
  objectName     String       @unique @map("object_name")

  @@map("agreement_attachment")
}

model LegacySalesVolume {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  vehicleClass   VehicleClass @map("vehicle_class")
  modelYear      ModelYear    @map("model_year")
  volume         Int

  @@unique([organizationId, vehicleClass, modelYear])
  @@map("legacy_sales_volume")
}

model SupplyVolume {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  vehicleClass   VehicleClass @map("vehicle_class")
  modelYear      ModelYear    @map("model_year")
  volume         Int

  @@unique([organizationId, vehicleClass, modelYear])
  @@map("supply_volume")
}

enum ModelYearReportStatus {
  ASSESSED
  DRAFT
  RETURNED_TO_ANALYST
  RETURNED_TO_SUPPLIER
  SUBMITTED_TO_DIRECTOR
  SUBMITTED_TO_GOVERNMENT
}

enum ModelYearReportSupplierStatus {
  ASSESSED
  DRAFT
  RETURNED_TO_SUPPLIER
  SUBMITTED_TO_GOVERNMENT
}

enum ReassessmentStatus {
  DRAFT
  ISSUED
  RETURNED_TO_ANALYST
  SUBMITTED_TO_DIRECTOR
}

enum SupplementaryReportStatus {
  ACKNOWLEDGED
  DRAFT
  SUBMITTED
}

model ModelYearReport {
  id                        Int                           @id @default(autoincrement())
  organization              Organization                  @relation(fields: [organizationId], references: [id])
  organizationId            Int                           @map("organization_id")
  modelYear                 ModelYear                     @map("model_year")
  status                    ModelYearReportStatus
  supplierStatus            ModelYearReportSupplierStatus @map("supplier_status")
  reassessmentStatus        ReassessmentStatus?           @map("reassessment_status")
  supplementaryReportStatus SupplementaryReportStatus?    @map("supplementary_report_status")
  objectName                String                        @unique @map("object_name")
  forecastReportObjectName  String                        @unique @map("forecast_report_object_name")
  forecastReportFileName    String                        @map("forecast_report_file_name")
  compliant                 Boolean?
  reportableNvValue         Int?                          @map("reportable_nv_value")
  supplierClass             SupplierClass?                @map("supplier_class")
  modelYearReportHistory    ModelYearReportHistory[]
  assessment                Assessment?
  Reassessment              Reassessment[]
  supplementaryReports      SupplementaryReport[]

  @@unique([organizationId, modelYear])
  @@map("model_year_report")
}

model Assessment {
  id                Int             @id @default(autoincrement())
  modelYearReport   ModelYearReport @relation(fields: [modelYearReportId], references: [id])
  modelYearReportId Int             @unique @map("model_year_report_id")
  objectName        String          @unique @map("object_name")

  @@map("assessment")
}

model ModelYearReportHistory {
  id                Int                   @id @default(autoincrement())
  modelYearReportId Int                   @map("model_year_report_id")
  modelYearReport   ModelYearReport       @relation(fields: [modelYearReportId], references: [id])
  userId            Int                   @map("user_id")
  user              User                  @relation(fields: [userId], references: [id])
  timestamp         DateTime              @default(now()) @db.Timestamptz(6)
  userAction        ModelYearReportStatus @map("user_action")
  comment           String?

  @@map("model_year_report_history")
}

model LegacyAssessedModelYearReport {
  id               Int          @id @default(autoincrement())
  legacyId         Int          @unique @map("legacy_id")
  organization     Organization @relation(fields: [organizationId], references: [id])
  organizationId   Int          @map("organization_id")
  modelYear        ModelYear    @map("model_year")
  zevClassOrdering ZevClass[]   @map("zev_class_ordering")

  @@unique([organizationId, modelYear])
  @@map("legacy_assessed_model_year_report")
}

model SupplementaryReport {
  id                         Int                          @id @default(autoincrement())
  status                     SupplementaryReportStatus
  organization               Organization                 @relation(fields: [organizationId], references: [id])
  organizationId             Int                          @map("organization_id")
  modelYear                  ModelYear                    @map("model_year")
  modelYearReportId          Int?                         @map("model_year_report_id")
  modelYearReport            ModelYearReport?             @relation(fields: [modelYearReportId], references: [id])
  sequenceNumber             Int                          @map("sequence_number")
  objectName                 String                       @unique @map("object_name")
  SupplementaryReportHistory SupplementaryReportHistory[]

  @@unique([organizationId, modelYear, sequenceNumber])
  @@map("supplementary_report")
}

model SupplementaryReportHistory {
  id                    Int                       @id @default(autoincrement())
  supplementaryReportId Int                       @map("supplementary_report_id")
  supplementaryReport   SupplementaryReport       @relation(fields: [supplementaryReportId], references: [id])
  userId                Int                       @map("user_id")
  user                  User                      @relation(fields: [userId], references: [id])
  timestamp             DateTime                  @default(now()) @db.Timestamptz(6)
  userAction            SupplementaryReportStatus @map("user_action")
  comment               String?

  @@map("supplementary_report_history")
}

model Reassessment {
  id                  Int                   @id @default(autoincrement())
  status              ReassessmentStatus
  organization        Organization          @relation(fields: [organizationId], references: [id])
  organizationId      Int                   @map("organization_id")
  modelYear           ModelYear             @map("model_year")
  modelYearReportId   Int?                  @map("model_year_report_id")
  modelYearReport     ModelYearReport?      @relation(fields: [modelYearReportId], references: [id])
  sequenceNumber      Int                   @map("sequence_number")
  objectName          String                @unique @map("object_name")
  ReassessmentHistory ReassessmentHistory[]

  @@unique([organizationId, modelYear, sequenceNumber])
  @@map("reassessment")
}

model ReassessmentHistory {
  id             Int                @id @default(autoincrement())
  reassessmentId Int                @map("reassessment_id")
  reassessment   Reassessment       @relation(fields: [reassessmentId], references: [id])
  userId         Int                @map("user_id")
  user           User               @relation(fields: [userId], references: [id])
  timestamp      DateTime           @default(now()) @db.Timestamptz(6)
  userAction     ReassessmentStatus @map("user_action")
  comment        String?

  @@map("reassessment_history")
}
