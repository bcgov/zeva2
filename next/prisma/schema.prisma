generator client {
  provider        = "prisma-client-js"
  output          = "./generated/client"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// prisma doesn't allow enum values to start with a number
// this enum must be in ascending lexicographical order, as well as ascending logical order
enum ModelYear {
  MY_2017 @map("2017")
  MY_2018 @map("2018")
  MY_2019 @map("2019")
  MY_2020 @map("2020")
  MY_2021 @map("2021")
  MY_2022 @map("2022")
  MY_2023 @map("2023")
  MY_2024 @map("2024")
  MY_2025 @map("2025")
  MY_2026 @map("2026")
  MY_2027 @map("2027")
  MY_2028 @map("2028")
  MY_2029 @map("2029")
  MY_2030 @map("2030")
  MY_2031 @map("2031")
  MY_2032 @map("2032")
  MY_2033 @map("2033")
  MY_2034 @map("2034")
  MY_2035 @map("2035")
  MY_2036 @map("2036")
}

model Organization {
  id                            Int                             @id @default(autoincrement())
  name                          String
  isGovernment                  Boolean                         @default(false) @map("is_government")
  isActive                      Boolean                         @default(true) @map("is_active")
  shortName                     String                          @map("short_name")
  firstModelYear                ModelYear?                      @map("first_model_year")
  users                         User[]
  zevUnitTransactions           ZevUnitTransaction[]
  zevUnitEndingBalances         ZevUnitEndingBalance[]
  creditTransferTo              CreditTransfer[]                @relation("creditTransferTo")
  creditTransferFrom            CreditTransfer[]                @relation("creditTransferFrom")
  Vehicle                       Vehicle[]
  VehicleHistory                VehicleHistory[]
  organizationAddress           OrganizationAddress[]
  ldvSupplied                   OrganizationLDVSupplied[]
  CreditApplication             CreditApplication[]
  PenaltyCredit                 PenaltyCredit[]
  agreements                    Agreement[]
  LegacySalesVolume             LegacySalesVolume[]
  SupplyVolume                  SupplyVolume[]
  ModelYearReport               ModelYearReport[]
  Reassessment                  Reassessment[]
  SupplementaryReport           SupplementaryReport[]
  LegacyAssessedModelYearReport LegacyAssessedModelYearReport[]

  @@map("organization")
}

model OrganizationAddress {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  addressType    AddressType  @map("address_type")
  expirationDate DateTime?    @map("expiration_date") @db.Date
  addressLines   String?      @map("address_lines")
  city           String?
  postalCode     String?      @map("postal_code")
  state          String?
  county         String?
  country        String?
  representative String?

  @@index([organizationId, addressType, expirationDate], map: "organization_address_organization_type_expiration")
  @@map("organization_address")
}

model OrganizationLDVSupplied {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  volume         Int
  modelYear      ModelYear    @map("model_year")

  @@index([organizationId, modelYear], map: "organization_id_model_year")
  @@map("organization_ldv_supplied")
}

enum AddressType {
  RECORDS
  SERVICE
}

enum Role {
  ADMINISTRATOR              @map("Administrator")
  DIRECTOR                   @map("Director")
  ENGINEER_ANALYST           @map("Engineer/Analyst")
  ORGANIZATION_ADMINISTRATOR @map("Organization Administrator")
  SIGNING_AUTHORITY          @map("Signing Authority")
  ZEVA_USER                  @map("ZEVA User")
}

enum Idp {
  AZURE_IDIR     @map("azureidir")
  BCEID_BUSINESS @map("bceidbusiness")
}

enum Notification {
  CREDIT_APPLICATION
  CREDIT_TRANSFER
  MODEL_YEAR_REPORT
  ZEV_MODEL
}

model User {
  id                         Int                          @id @default(autoincrement())
  contactEmail               String?                      @map("contact_email")
  idpSub                     String?                      @map("idp_sub")
  idp                        Idp                          @map("idp")
  idpUsername                String                       @map("idp_username")
  isActive                   Boolean                      @default(true) @map("is_active")
  organization               Organization                 @relation(fields: [organizationId], references: [id])
  organizationId             Int                          @map("organization_id")
  roles                      Role[]
  notifications              Notification[]
  firstName                  String                       @map("first_name")
  lastName                   String                       @map("last_name")
  VehicleHistory             VehicleHistory[]
  CreditApplicationHistory   CreditApplicationHistory[]
  PenaltyCreditHistory       PenaltyCreditHistory[]
  AgreementHistory           AgreementHistory[]
  ModelYearReportHistory     ModelYearReportHistory[]
  ReassessmentHistory        ReassessmentHistory[]
  CreditTransferHistory      CreditTransferHistory[]
  SupplementaryReportHistory SupplementaryReportHistory[]

  @@unique([idp, idpUsername])
  @@map("user")
}

enum TransactionType {
  CREDIT
  DEBIT
  TRANSFER_AWAY
}

enum ReferenceType {
  TRANSFER
  PENALTY_CREDITS
  OBLIGATION_REDUCTION
  ASSESSMENT_ADJUSTMENT
  SUPPLY_CREDITS
  AGREEMENT
}

enum ZevClass {
  A
  B
  C
  UNSPECIFIED
}

enum VehicleClass {
  REPORTABLE
}

model ZevUnitTransaction {
  id                Int             @id @default(autoincrement())
  organization      Organization    @relation(fields: [organizationId], references: [id])
  organizationId    Int             @map("organization_id")
  type              TransactionType
  referenceType     ReferenceType   @map("reference_type")
  referenceId       Int?            @map("reference_id")
  legacyReferenceId Int?            @map("legacy_reference_id")
  numberOfUnits     Decimal         @map("number_of_units") @db.Decimal(65, 2)
  zevClass          ZevClass        @map("zev_class")
  vehicleClass      VehicleClass    @map("vehicle_class")
  modelYear         ModelYear       @map("model_year")
  timestamp         DateTime        @default(now()) @db.Timestamptz(6)

  @@map("zev_unit_transaction")
}

enum BalanceType {
  CREDIT
  DEBIT
}

model ZevUnitEndingBalance {
  id                   Int          @id @default(autoincrement())
  organization         Organization @relation(fields: [organizationId], references: [id])
  organizationId       Int          @map("organization_id")
  complianceYear       ModelYear    @map("compliance_year")
  type                 BalanceType
  initialNumberOfUnits Decimal      @map("initial_number_of_units") @db.Decimal(65, 2)
  finalNumberOfUnits   Decimal      @map("final_number_of_units") @db.Decimal(65, 2)
  zevClass             ZevClass     @map("zev_class")
  vehicleClass         VehicleClass @map("vehicle_class")
  modelYear            ModelYear    @map("model_year")

  @@unique([organizationId, complianceYear, zevClass, vehicleClass, modelYear])
  @@map("zev_unit_ending_balance")
}

enum CreditTransferStatus {
  SUBMITTED_TO_TRANSFER_TO
  RESCINDED_BY_TRANSFER_FROM
  APPROVED_BY_TRANSFER_TO
  REJECTED_BY_TRANSFER_TO
  RECOMMEND_APPROVAL_GOV
  RECOMMEND_REJECTION_GOV
  RETURNED_TO_ANALYST
  APPROVED_BY_GOV
  REJECTED_BY_GOV
}

enum CreditTransferSupplierStatus {
  SUBMITTED_TO_TRANSFER_TO
  RESCINDED_BY_TRANSFER_FROM
  APPROVED_BY_TRANSFER_TO
  REJECTED_BY_TRANSFER_TO
  APPROVED_BY_GOV
  REJECTED_BY_GOV
}

model CreditTransfer {
  id                    Int                          @id @default(autoincrement())
  transferToId          Int                          @map("transfer_to_id")
  transferTo            Organization                 @relation("creditTransferTo", fields: [transferToId], references: [id])
  transferFromId        Int                          @map("transfer_from_id")
  transferFrom          Organization                 @relation("creditTransferFrom", fields: [transferFromId], references: [id])
  status                CreditTransferStatus
  supplierStatus        CreditTransferSupplierStatus
  creditTransferContent CreditTransferContent[]
  creditTransferHistory CreditTransferHistory[]

  @@map("credit_transfer")
}

model CreditTransferContent {
  id                 Int            @id @default(autoincrement())
  creditTransferId   Int            @map("credit_transfer_id")
  creditTransfer     CreditTransfer @relation(fields: [creditTransferId], references: [id])
  numberOfUnits      Decimal        @map("number_of_units") @db.Decimal(65, 2)
  zevClass           ZevClass       @map("zev_class")
  vehicleClass       VehicleClass   @map("vehicle_class")
  modelYear          ModelYear      @map("model_year")
  dollarValuePerUnit Decimal        @map("dollar_value_per_unit") @db.Decimal(65, 2)

  @@map("credit_transfer_content")
}

model CreditTransferHistory {
  id               Int                  @id @default(autoincrement())
  creditTransferId Int                  @map("credit_transfer_id")
  creditTransfer   CreditTransfer       @relation(fields: [creditTransferId], references: [id])
  userId           Int                  @map("user_id")
  user             User                 @relation(fields: [userId], references: [id])
  timestamp        DateTime             @default(now()) @db.Timestamptz(6)
  userAction       CreditTransferStatus @map("user_action")
  comment          String?

  @@map("credit_transfer_history")
}

enum VehicleZevType {
  BEV
  PHEV
  EREV
  FCEV
}

enum VehicleClassCode {
  T
  I
  S
  C
  M
  L
  WS
  WM
  PS
  PL
  US
  UL
  V
  VC
  VP
  SP
}

enum VehicleStatus {
  DELETED
  REJECTED
  SUBMITTED
  VALIDATED
}

model Vehicle {
  id                Int                 @id @default(autoincrement())
  legacyId          Int?
  organization      Organization        @relation(fields: [organizationId], references: [id])
  organizationId    Int                 @map("organization_id")
  status            VehicleStatus
  make              String
  modelName         String              @map("model_name")
  modelYear         ModelYear           @map("model_year")
  vehicleZevType    VehicleZevType      @map("vehicle_zev_type")
  range             Int
  vehicleClass      VehicleClass        @map("vehicle_class")
  zevClass          ZevClass            @map("zev_class")
  numberOfUnits     Decimal             @map("numberOfUnits") @db.Decimal(65, 2)
  vehicleClassCode  VehicleClassCode    @map("vehicle_class_code")
  weight            Int
  us06RangeGte16    Boolean             @map("us06_range_gte_16")
  isActive          Boolean             @map("is_active")
  issuedCount       Int                 @default(0) @map("issued_count")
  submittedCount    Int                 @default(0) @map("submitted_count")
  VehicleHistory    VehicleHistory[]
  VehicleAttachment VehicleAttachment[]

  @@map("vehicle")
}

model VehicleHistory {
  id             Int           @id @default(autoincrement())
  vehicleId      Int           @map("vehicle_id")
  vehicle        Vehicle       @relation(fields: [vehicleId], references: [id])
  userId         Int           @map("user_id")
  user           User          @relation(fields: [userId], references: [id])
  timestamp      DateTime      @default(now()) @db.Timestamptz(6)
  userAction     VehicleStatus @map("user_action")
  comment        String?
  Organization   Organization? @relation(fields: [organizationId], references: [id])
  organizationId Int?

  @@map("vehicle_history")
}

model VehicleAttachment {
  id         Int     @id @default(autoincrement())
  vehicleId  Int     @map("vehicle_id")
  vehicle    Vehicle @relation(fields: [vehicleId], references: [id])
  fileName   String  @map("file_name")
  objectName String  @map("object_name")

  @@map("vehicle_file_attachment")
}

enum IcbcFileStatus {
  FAILURE
  PROCESSING
  SUCCESS
}

model IcbcFile {
  id                            Int            @id @default(autoincrement())
  isLegacy                      Boolean        @default(false) @map("is_legacy")
  name                          String         @unique
  status                        IcbcFileStatus
  timestamp                     DateTime       @db.Timestamptz(6)
  numberOfRecordsPreProcessing  Int?           @map("number_of_records_pre_processing")
  numberOfRecordsPostProcessing Int?           @map("number_of_records_post_processing")
  icbcRecords                   IcbcRecord[]

  @@map("icbc_file")
}

model IcbcRecord {
  id         Int       @id @default(autoincrement())
  icbcFileId Int       @map("icbc_file_id")
  icbcFile   IcbcFile  @relation(fields: [icbcFileId], references: [id])
  vin        String    @unique @db.VarChar(17)
  make       String
  model      String
  year       ModelYear

  @@map("icbc_record")
}

enum CreditApplicationStatus {
  APPROVED
  DELETED
  DRAFT
  RECOMMEND_APPROVAL
  REJECTED
  RETURNED_TO_ANALYST
  SUBMITTED
}

enum CreditApplicationSupplierStatus {
  APPROVED
  DELETED
  DRAFT
  REJECTED
  SUBMITTED
}

model CreditApplication {
  id                          Int                             @id @default(autoincrement())
  organization                Organization                    @relation(fields: [organizationId], references: [id])
  organizationId              Int                             @map("organization_id")
  submissionTimestamp         DateTime?                       @map("submission_timestamp") @db.Timestamptz(6)
  transactionTimestamp        DateTime?                       @map("transaction_timestamp") @db.Timestamptz(6)
  status                      CreditApplicationStatus         @map("status")
  supplierStatus              CreditApplicationSupplierStatus @map("supplier_status")
  objectName                  String                          @unique @map("object_name")
  fileName                    String                          @map("file_name")
  modelYears                  ModelYear[]                     @map("model_years")
  acceptedVinsCount           Int?                            @map("accepted_vins_count")
  rejectedVinsCount           Int?                            @map("rejected_vins_count")
  CreditApplicationHistory    CreditApplicationHistory[]
  CreditApplicationRecord     CreditApplicationRecord[]
  CreditApplicationAttachment CreditApplicationAttachment[]

  @@map("credit_application")
}

enum CreditApplicationHistoryStatus {
  APPROVED
  RECOMMEND_APPROVAL
  REJECTED
  RETURNED_TO_ANALYST
  SUBMITTED
}

model CreditApplicationHistory {
  id                  Int                            @id @default(autoincrement())
  creditApplicationId Int                            @map("credit_application_id")
  creditApplication   CreditApplication              @relation(fields: [creditApplicationId], references: [id])
  userId              Int                            @map("user_id")
  user                User                           @relation(fields: [userId], references: [id])
  timestamp           DateTime                       @default(now()) @db.Timestamptz(6)
  userAction          CreditApplicationHistoryStatus @map("user_action")
  comment             String?

  @@map("credit_application_history")
}

model CreditApplicationRecord {
  id                  Int               @id @default(autoincrement())
  creditApplicationId Int               @map("credit_application_id")
  creditApplication   CreditApplication @relation(fields: [creditApplicationId], references: [id])
  vin                 String            @db.VarChar(17)
  timestamp           DateTime          @db.Timestamptz(6)
  vehicleClass        VehicleClass      @map("vehicle_class")
  zevClass            ZevClass          @map("zev_class")
  modelYear           ModelYear         @map("model_year")
  numberOfUnits       Decimal           @map("number_of_units") @db.Decimal(65, 2)
  make                String
  modelName           String            @map("model_name")
  icbcMake            String?           @map("icbc_make")
  icbcModelName       String?           @map("icbc_model_name")
  icbcModelYear       ModelYear?        @map("icbc_model_year")
  icbcTimestamp       DateTime?         @map("icbc_timestamp") @db.Timestamptz(6)
  validated           Boolean
  reason              String?
  warnings            String[]

  @@map("credit_application_record")
}

model CreditApplicationAttachment {
  id                  Int               @id @default(autoincrement())
  creditApplicationId Int               @map("credit_application_id")
  creditApplication   CreditApplication @relation(fields: [creditApplicationId], references: [id])
  fileName            String            @map("file_name")
  objectName          String            @unique @map("object_name")

  @@map("credit_application_attachment")
}

model ReservedVin {
  id  Int    @id @default(autoincrement())
  vin String @unique @db.VarChar(17)

  @@map("reserved_vin")
}

enum PenaltyCreditStatus {
  APPROVED
  REJECTED
  SUBMITTED_TO_DIRECTOR
}

model PenaltyCredit {
  id                   Int                    @id @default(autoincrement())
  organization         Organization           @relation(fields: [organizationId], references: [id])
  organizationId       Int                    @map("organization_id")
  complianceYear       ModelYear              @map("compliance_year")
  status               PenaltyCreditStatus
  vehicleClass         VehicleClass           @map("vehicle_class")
  zevClass             ZevClass               @map("zev_class")
  modelYear            ModelYear              @map("model_year")
  numberOfUnits        Decimal                @map("number_of_units") @db.Decimal(65, 2)
  PenaltyCreditHistory PenaltyCreditHistory[]

  @@map("penalty_credit")
}

model PenaltyCreditHistory {
  id              Int                 @id @default(autoincrement())
  penaltyCredit   PenaltyCredit       @relation(fields: [penaltyCreditId], references: [id])
  penaltyCreditId Int                 @map("penalty_credit_id")
  userId          Int                 @map("user_id")
  user            User                @relation(fields: [userId], references: [id])
  timestamp       DateTime            @default(now()) @db.Timestamptz(6)
  userAction      PenaltyCreditStatus @map("user_action")
  comment         String?

  @@map("penalty_credit_history")
}

enum AgreementType {
  INITIATIVE
  PURCHASE
}

enum AgreementStatus {
  DRAFT
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
  ISSUED
  DELETED
}

enum AgreementUserAction {
  SAVED
  RECOMMEND_APPROVAL
  RETURNED_TO_ANALYST
  ISSUED
  DELETED
  ADDED_COMMENT_GOV_INTERNAL
}

model Agreement {
  id                  Int                   @id @default(autoincrement())
  referenceId         String?               @map("reference_id")
  organization        Organization          @relation(fields: [organizationId], references: [id])
  organizationId      Int                   @map("organization_id")
  agreementType       AgreementType         @map("agreement_type")
  status              AgreementStatus
  effectiveDate       DateTime?             @map("effective_date") @db.Date
  comment             String?
  agreementContent    AgreementContent[]
  agreementHistory    AgreementHistory[]
  agreementAttachment AgreementAttachment[]

  @@map("agreement")
}

model AgreementContent {
  id            Int       @id @default(autoincrement())
  agreement     Agreement @relation(fields: [agreementId], references: [id])
  agreementId   Int       @map("agreement_id")
  zevClass      ZevClass  @map("zev_class")
  modelYear     ModelYear @map("model_year")
  numberOfUnits Decimal   @map("number_of_units") @db.Decimal(65, 2)

  @@map("agreement_content")
}

model AgreementHistory {
  id               Int                 @id @default(autoincrement())
  agreementId      Int                 @map("agreement_id")
  agreement        Agreement           @relation(fields: [agreementId], references: [id])
  userId           Int                 @map("user_id")
  user             User                @relation(fields: [userId], references: [id])
  timestamp        DateTime            @default(now()) @db.Timestamptz(6)
  userAction       AgreementUserAction @map("user_action")
  agreementComment AgreementComment?

  @@map("agreement_history")
}

model AgreementComment {
  id                 Int              @id @default(autoincrement())
  agreementHistoryId Int              @unique @map("agreement_history_id")
  agreementHistory   AgreementHistory @relation(fields: [agreementHistoryId], references: [id])
  comment            String

  @@map("agreement_comment")
}

model AgreementAttachment {
  id          Int       @id @default(autoincrement())
  agreementId Int       @map("agreement_id")
  agreement   Agreement @relation(fields: [agreementId], references: [id])
  fileName    String    @map("file_name")
  objectName  String    @map("object_name")

  @@index([objectName], map: "object_name")
  @@map("agreement_attachment")
}

model LegacySalesVolume {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  vehicleClass   VehicleClass @map("vehicle_class")
  modelYear      ModelYear    @map("model_year")
  volume         Int

  @@unique([organizationId, vehicleClass, modelYear])
  @@map("legacy_sales_volume")
}

model SupplyVolume {
  id             Int          @id @default(autoincrement())
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int          @map("organization_id")
  vehicleClass   VehicleClass @map("vehicle_class")
  modelYear      ModelYear    @map("model_year")
  volume         Int

  @@unique([organizationId, vehicleClass, modelYear])
  @@map("supply_volume")
}

enum ModelYearReportStatus {
  ASSESSED
  RETURNED_TO_ANALYST
  RETURNED_TO_SUPPLIER
  SUBMITTED_TO_DIRECTOR
  SUBMITTED_TO_GOVERNMENT
}

enum ModelYearReportSupplierStatus {
  ASSESSED
  RETURNED_TO_SUPPLIER
  SUBMITTED_TO_GOVERNMENT
}

enum ReassessmentStatus {
  DELETED
  ISSUED
  RETURNED_TO_ANALYST
  SUBMITTED_TO_DIRECTOR
}

enum SupplierReassessmentStatus {
  ISSUED
}

model ModelYearReport {
  id                         Int                           @id @default(autoincrement())
  organization               Organization                  @relation(fields: [organizationId], references: [id])
  organizationId             Int                           @map("organization_id")
  modelYear                  ModelYear                     @map("model_year")
  status                     ModelYearReportStatus
  supplierStatus             ModelYearReportSupplierStatus @map("supplier_status")
  reassessmentStatus         ReassessmentStatus?           @map("reassessment_status")
  supplierReassessmentStatus SupplierReassessmentStatus?   @map("supplier_reassessment_status")
  objectName                 String                        @unique @map("object_name")
  forecastReportObjectName   String                        @unique @map("forecast_report_object_name")
  modelYearReportHistory     ModelYearReportHistory[]
  assessment                 Assessment?
  Reassessment               Reassessment[]

  @@unique([organizationId, modelYear])
  @@map("model_year_report")
}

model Assessment {
  id                Int             @id @default(autoincrement())
  modelYearReport   ModelYearReport @relation(fields: [modelYearReportId], references: [id])
  modelYearReportId Int             @unique @map("model_year_report_id")
  objectName        String          @unique @map("object_name")

  @@map("assessment")
}

model ModelYearReportHistory {
  id                Int                   @id @default(autoincrement())
  modelYearReportId Int                   @map("model_year_report_id")
  modelYearReport   ModelYearReport       @relation(fields: [modelYearReportId], references: [id])
  userId            Int                   @map("user_id")
  user              User                  @relation(fields: [userId], references: [id])
  timestamp         DateTime              @default(now()) @db.Timestamptz(6)
  userAction        ModelYearReportStatus @map("user_action")
  comment           String?

  @@map("model_year_report_history")
}

model LegacyAssessedModelYearReport {
  id               Int          @id @default(autoincrement())
  legacyId         Int          @unique @map("legacy_id")
  organization     Organization @relation(fields: [organizationId], references: [id])
  organizationId   Int          @map("organization_id")
  modelYear        ModelYear    @map("model_year")
  zevClassOrdering ZevClass[]   @map("zev_class_ordering")

  @@unique([organizationId, modelYear])
  @@map("legacy_assessed_model_year_report")
}

enum SupplementaryReportStatus {
  ACKNOWLEDGED
  SUBMITTED_TO_GOVERNMENT
}

model SupplementaryReport {
  id                         Int                          @id @default(autoincrement())
  status                     SupplementaryReportStatus
  organization               Organization                 @relation(fields: [organizationId], references: [id])
  organizationId             Int                          @map("organization_id")
  modelYear                  ModelYear                    @map("model_year")
  sequenceNumber             Int                          @map("sequence_number")
  fileName                   String                       @map("file_name")
  objectName                 String                       @unique @map("object_name")
  SupplementaryReportHistory SupplementaryReportHistory[]

  @@unique([organizationId, modelYear, sequenceNumber])
  @@map("supplementary_report")
}

model SupplementaryReportHistory {
  id                    Int                       @id @default(autoincrement())
  supplementaryReportId Int                       @map("supplementary_report_id")
  supplementaryReport   SupplementaryReport       @relation(fields: [supplementaryReportId], references: [id])
  userId                Int                       @map("user_id")
  user                  User                      @relation(fields: [userId], references: [id])
  timestamp             DateTime                  @default(now()) @db.Timestamptz(6)
  userAction            SupplementaryReportStatus @map("user_action")
  comment               String?

  @@map("supplementary_report_history")
}

model Reassessment {
  id                  Int                   @id @default(autoincrement())
  status              ReassessmentStatus
  organization        Organization          @relation(fields: [organizationId], references: [id])
  organizationId      Int                   @map("organization_id")
  modelYear           ModelYear             @map("model_year")
  modelYearReportId   Int?                  @map("model_year_report_id")
  modelYearReport     ModelYearReport?      @relation(fields: [modelYearReportId], references: [id])
  sequenceNumber      Int                   @map("sequence_number")
  objectName          String                @unique @map("object_name")
  ReassessmentHistory ReassessmentHistory[]

  @@unique([organizationId, modelYear, sequenceNumber])
  @@map("reassessment")
}

model ReassessmentHistory {
  id             Int                @id @default(autoincrement())
  reassessmentId Int                @map("reassessment_id")
  reassessment   Reassessment       @relation(fields: [reassessmentId], references: [id])
  userId         Int                @map("user_id")
  user           User               @relation(fields: [userId], references: [id])
  timestamp      DateTime           @default(now()) @db.Timestamptz(6)
  userAction     ReassessmentStatus @map("user_action")
  comment        String?

  @@map("reassessment_history")
}
